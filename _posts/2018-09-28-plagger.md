---
layout: post
title: "Plagger でウェブをメールに集約"
description: ""
category: 
tags: 
---
{% include JB/setup %}

## Plagger とは

IFTTT や Zapier などの登場により
10年前に流行は終わってしまった感がある Plagger ではあるが、
ウェブをメールに集約するならばいまだ Plagger の代替となるものはないと思う。

フィードのRSS広告を除去して、本文を抽出して、はてなブックマーク数を付けるといったことが行える。

詳しくは[プレゼン資料](http://plagger.bulknews.net/trac/wiki/PlaggerPresentations)を参照。


## インストール

* システムを汚したくないので plenv と cpanm を使って HOME 以下にインストールする
* インストールした Perl や Plagger に PATH を通さない
* テストでエラーが出るものは --notest つきでインストールする
* Plagger はインストールせずにレポジトリから直に使用するのが推奨のためインストールしない (assets_path の指定が不要になる。)


~~~sh
sudo apt-get install -y libxml2-dev zlib1g-dev libexpat1-dev libdb-dev libssl-dev libgmp-dev unzip libmpfr-dev swig
git clone https://github.com/tokuhirom/plenv.git ~/.plenv
git clone https://github.com/tokuhirom/Perl-Build.git ~/.plenv/plugins/perl-build

# 子 bash に一旦入る。
PATH="$HOME/.plenv/bin:$PATH" bash
eval "$(plenv init -)"

plenv install -l | head 

# バージョンを選択する。マイナーバージョンが偶数が安定版。
plenv install 5.28.0
plenv global 5.28.0
plenv install-cpanm

cpanm YAML::Loader::Base
cpanm Module::Install::TestBase
cpanm LWP::Protocol::https

git clone https://github.com/miyagawa/plagger.git ~/.plagger/repo

cpanm --installdeps ~/.plagger/repo

# エラーがでるなら個別に
cpanm IO::Socket::SSL --notest

plenv rehash

# bash を抜ける
exit
~~~

動作確認

~~~sh
~/.plenv/bin/plenv exec perl ~/.plagger/repo/plagger -v
~~~

適当な場所 (~/.plagger/conf/*.yaml) に設定ファイルを置いて、
適当なシュルスクリプト (run-plagger) を作成する。

~~~sh
#! /bin/bash

for i in ~/.plagger/conf/*.yaml ; do
   ~/.plenv/bin/plenv exec perl ~/.plagger/repo/plagger -c $i
done
~~~

